<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Questions for Review</title>
  <style>
  :root {
    --color-primary: #005b94;
    --color-highlight: #27ae60;
    --color-wrong: #e74c3c;
    --color-correct-bg: #e6f9ec;
    --color-wrong-bg: #fdecea;
  }

  body {
    font-family: 'Inter', sans-serif;
    background: #f5f5f5;
    padding: 30px;
    max-width: 900px;
    margin: auto;
  }

  h1 {
    color: var(--color-primary);
    text-align: center;
    margin-bottom: 40px;
  }

  .question {
    background: white;
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 30px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.06);
  }

  .question h3 {
    color: var(--color-primary);
    margin-bottom: 10px;
  }

  .option {
    padding: 12px;
    border-radius: 6px;
    margin: 8px 0;
    border: 1px solid #ccc;
    transition: all 0.3s;
  }

  .correct {
    border-left: 5px solid var(--color-highlight);
    background-color: var(--color-correct-bg);
    color: var(--color-highlight);
  }

  .incorrect {
    border-left: 5px solid var(--color-wrong);
    background-color: var(--color-wrong-bg);
    color: var(--color-wrong);
  }

  .explanation {
    margin-top: 18px;
    padding: 12px;
    border-left: 4px solid #ccc;
    background-color: #f9f9f9;
    border-radius: 6px;
  }

  .explanation.correct {
    border-left-color: var(--color-highlight);
    color: var(--color-highlight);
  }

  .explanation.incorrect {
    border-left-color: var(--color-wrong);
    color: var(--color-wrong);
  }

  .btn {
    display: inline-block;
    padding: 12px 24px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin: 10px;
    transition: background 0.3s;
  }

  .btn-primary {
    background-color: var(--color-primary);
    color: white;
  }

  .btn-highlight {
    background-color: var(--color-highlight);
    color: white;
  }

  .btn-warn {
    background-color: var(--color-wrong);
    color: white;
  }
</style>

</head>
<body>
<div style="text-align: center; margin-bottom: 30px;">
  <a href="index.html">
    <img src="logo-brainboxmed-transparent.png" alt="BrainboxMed Logo" style="max-width: 250px; cursor: pointer;">
  </a>
</div>

  <h1>Questions for Review</h1>
  <p id="block-counter" style="text-align: center; font-size: 18px; color: #333; margin-bottom: 20px;"></p>

  <div id="report"></div>

 <script>
const questionnaire = JSON.parse(localStorage.getItem('currentQuestionnaire')) || [];
const answers = JSON.parse(localStorage.getItem('userAnswers')) || {};
const language = localStorage.getItem('selectedLanguage') || 'en';

const reportContainer = document.getElementById('report');

questionnaire.forEach((q, i) => {
  const userAnswer = answers[q.id];
  const isCorrect = userAnswer === q.correct;
  const hasAnswer = typeof userAnswer !== 'undefined';
  const questionText = q.question?.[language] || q.question?.en || "";
  const options = q.options || [];
  const explanation = q.explanations?.en || ""; // Always show in English

  const levelLabels = {
    easy: { pt: "F√°cil", en: "Easy", es: "F√°cil" },
    moderate: { pt: "Moderada", en: "Moderate", es: "Moderada" },
    hard: { pt: "Dif√≠cil", en: "Hard", es: "Dif√≠cil" },
    very_hard: { pt: "Muito Dif√≠cil", en: "Very Hard", es: "Muy Dif√≠cil" }
  };
  const difficulty = q.level;
  const labelLevel = levelLabels[difficulty]?.[language] || difficulty;

  const questionBlock = document.createElement('div');
  questionBlock.className = 'question';
  questionBlock.innerHTML = `
    <h3>Question ${i + 1} <span style="font-size: 0.8em; color: #888;">‚Ä¢ ${labelLevel}</span></h3>
    <p><strong>${questionText}</strong></p>

    <div>
      ${options.map((opt, idx) => {
        let cssClass = '';
        if (idx === q.correct) cssClass = 'correct';
        if (hasAnswer && idx === userAnswer && userAnswer !== q.correct) cssClass = 'incorrect';
        const text = opt.text?.[language] || opt.text?.en || "";
        return `<div class="option ${cssClass}">${text}</div>`;
      }).join('')}
    </div>

    <div class="explanation ${isCorrect ? 'correct' : 'incorrect'}">
      ${isCorrect ? '‚úì' : '‚úñ'} ${explanation}
    </div>
  `;
  reportContainer.appendChild(questionBlock);
});

const accumulated = JSON.parse(localStorage.getItem('accumulatedQuestions')) || [];
const totalBlocks = Math.floor((accumulated.length + questionnaire.length) / 10);

const blockTexts = {
  pt: `Bloco ${totalBlocks} / 5`,
  en: `Set ${totalBlocks} / 5`,
  es: `Bloque ${totalBlocks} / 5`
};

document.getElementById('block-counter').textContent = blockTexts[language] || `Block ${totalBlocks} / 5`;

document.addEventListener('DOMContentLoaded', function () {
  const nextSetTexts = {
    pt: "Pr√≥ximo Bloco de Quest√µes",
    en: "Next Set of Questions",
    es: "Siguiente Bloque de Preguntas"
  };

  const btn = document.getElementById('next-set-btn');
  if (btn) {
    btn.addEventListener('click', () => {
      const accumulatedQuestions = JSON.parse(localStorage.getItem('accumulatedQuestions')) || [];
      const accumulatedAnswers = JSON.parse(localStorage.getItem('accumulatedAnswers')) || {};

      questionnaire.forEach(q => {
        if (!accumulatedQuestions.some(q2 => q2.id === q.id)) {
          accumulatedQuestions.push(q);
        }
      });

      Object.keys(answers).forEach(id => {
        accumulatedAnswers[id] = answers[id];
      });

      localStorage.setItem('accumulatedQuestions', JSON.stringify(accumulatedQuestions));
      localStorage.setItem('accumulatedAnswers', JSON.stringify(accumulatedAnswers));

      if (accumulatedQuestions.length >= 50) {
        window.location.href = "relatorioFinal.html";
      } else {
        localStorage.setItem('autoStartStudyMode', 'true');
        window.location.href = "index.html";
      }
    });
  }
});

// Show restart button only at the end of block 5
if (totalBlocks === 5) {
  const restartBtn = document.createElement('button');
  restartBtn.textContent = {
    pt: "Reiniciar Modo Estudo",
    en: "Restart Study Mode",
    es: "Reiniciar Modo de Estudio"
  }[language] || "Restart";

  restartBtn.style = "margin-top: 30px; padding: 12px 24px; font-size: 16px; background-color: #f39c12; color: white; border: none; border-radius: 6px; cursor: pointer; display: block; margin-left: auto; margin-right: auto;";

  restartBtn.onclick = () => {
    localStorage.removeItem('accumulatedQuestions');
    localStorage.removeItem('accumulatedAnswers');
    localStorage.setItem('autoStartStudyMode', 'true');
    localStorage.removeItem('currentQuestionnaire');
    localStorage.removeItem('userAnswers');
    localStorage.removeItem('currentQuestionIndex');
    window.location.href = "index.html";
  };

  document.body.appendChild(restartBtn);
}

function confirmReturnHome() {
  const lang = localStorage.getItem('selectedLanguage') || 'en';
  const confirmMessages = {
    en: "If you return to the home page, your answers will be lost. Are you sure?",
    pt: "Caso retorne √† p√°gina inicial, suas respostas ser√£o perdidas. Tem certeza?",
    es: "Si regresa a la p√°gina principal, sus respuestas se perder√°n. ¬øEst√° seguro?"
  };
  if (confirm(confirmMessages[lang])) {
    window.location.href = 'index.html';
  }
}

function returnToReport() {
  const accumulatedQuestions = JSON.parse(localStorage.getItem('accumulatedQuestions')) || [];
  const accumulatedAnswers = JSON.parse(localStorage.getItem('accumulatedAnswers')) || {};

  questionnaire.forEach(q => {
    if (!accumulatedQuestions.some(q2 => q2.id === q.id)) {
      accumulatedQuestions.push(q);
    }
  });

  Object.keys(answers).forEach(id => {
    accumulatedAnswers[id] = answers[id];
  });

  localStorage.setItem('accumulatedQuestions', JSON.stringify(accumulatedQuestions));
  localStorage.setItem('accumulatedAnswers', JSON.stringify(accumulatedAnswers));
  localStorage.setItem('reviewReturn', 'true');
  window.location.href = "index.html";
}
</script>

  <div id="next-block-controls" style="text-align: center; margin-top: 50px;">
  <p id="block-label" style="font-size: 18px; color: #333; margin-bottom: 15px;"></p>
  <button id="next-set-btn" class="btn btn-highlight" style="font-size: 18px;">
    ‚û°Ô∏è Next Block
  </button>
  </div>
<div style="text-align: center; margin-top: 50px;">
  <button class="btn btn-primary" onclick="returnToReport()">
  ‚Üê Return to Report
  </button>
  <button class="btn btn-warn" onclick="confirmReturnHome()" style="margin-left: 15px;">
    üè† Home
  </button>
</div>


</body>
</html>
